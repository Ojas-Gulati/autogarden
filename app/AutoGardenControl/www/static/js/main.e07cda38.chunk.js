(this["webpackJsonpio.cordova.hellocordova"]=this["webpackJsonpio.cordova.hellocordova"]||[]).push([[0],{21:function(e,t,n){},23:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n(2),i=n.n(a),r=n(13),c=n.n(r),o=(n(21),n(14)),l=n(12),d=n(15),h=n(3),u=n.n(h),p=n(8),g=n(1),f=n(4),b=n(5),j=n(7),m=n(6),v=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).begin=s.begin.bind(Object(g.a)(s)),s.succeed=s.succeed.bind(Object(g.a)(s)),s.fail=s.fail.bind(Object(g.a)(s)),s.reset=s.reset.bind(Object(g.a)(s)),s.state={loading:!1,failed:!1,success:!1},s}return Object(b.a)(n,[{key:"begin",value:function(){this.setState({loading:!0,failed:!1,success:!1})}},{key:"succeed",value:function(){this.setState({loading:!1,failed:!1,success:!0})}},{key:"fail",value:function(){this.setState({loading:!1,failed:!0,success:!1})}},{key:"reset",value:function(){this.setState({loading:!1,failed:!1,success:!1})}},{key:"render",value:function(){return Object(s.jsxs)("span",{children:[this.state.loading?Object(s.jsx)("i",{className:"material-icons",children:"sync"}):null,this.state.failed?Object(s.jsx)("i",{className:"material-icons text-danger",children:"close"}):null,this.state.success?Object(s.jsx)("i",{className:"material-icons text-success",children:"done"}):null]})}}]),n}(i.a.Component),x=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).state={editing:!1,val:e.value},s}return Object(b.a)(n,[{key:"toggleEdit",value:function(e){var t=!this.state.editing;!0!==e&&!1!==e||(t=e),this.setState({editing:t}),t||this.props.update(this.state.val)}},{key:"render",value:function(){var e=this,t=null;return t=this.state.editing?Object(s.jsx)("input",{onChange:function(t){e.setState({val:t.target.value})},value:this.state.val}):this.props.value,Object(s.jsxs)("span",{children:[t," ",Object(s.jsx)("i",{className:"material-icons text-muted",onClick:function(){e.toggleEdit(null)},children:this.state.editing?"check":"edit"})]})}}]),n}(i.a.Component),O=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).state={flash:!1},s.flashtimeout,s.flash=s.flash.bind(Object(g.a)(s)),s}return Object(b.a)(n,[{key:"flash",value:function(){var e=this;console.log("flashed"),this.setState({flash:!0},(function(){e.flashtimeout=setTimeout((function(){e.setState({flash:!1})}),50)}))}},{key:"componentWillUnmount",value:function(){clearTimeout(this.flashtimeout)}},{key:"render",value:function(){return Object(s.jsx)("i",{className:"material-icons "+(this.state.flash?"":"flash-fade"),children:this.props.icon})}}]),n}(i.a.Component),w=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).showPopup=s.showPopup.bind(Object(g.a)(s)),s.hidePopup=s.hidePopup.bind(Object(g.a)(s)),s.fadingtimeout=null,s.state={fading_up:!1,fading_down:!0,faded:!0},s}return Object(b.a)(n,[{key:"showPopup",value:function(){var e=this;this.state.faded&&(this.setState({faded:!1,fading_down:!0,fading_up:!1}),setTimeout((function(){e.setState({faded:!1,fading_up:!0,fading_down:!1})}),50)),this.props.shown&&this.props.shown()}},{key:"hidePopup",value:function(){var e=this;this.state.faded||(this.setState({faded:!1,fading_up:!0,fading_down:!1}),setTimeout((function(){e.setState({faded:!1,fading_down:!0,fading_up:!1})}),50),setTimeout((function(){e.setState({faded:!0,fading_down:!0,fading_up:!1})}),1e3)),this.props.hidden&&this.props.hidden()}},{key:"render",value:function(){return Object(s.jsxs)("div",{className:"popup "+(this.state.faded?"ag-faded":"")+" "+(this.state.fading_up?"ag-fading_up":"")+" "+(this.state.fading_down?"ag-fading_down":""),children:[Object(s.jsx)("div",{className:"popupX",children:Object(s.jsx)("i",{className:"float-right ml-auto material-icons cursor-pointer font-size-medium",onClick:this.hidePopup,children:"close"})}),Object(s.jsx)("div",{className:"overflow-overlay floating-scrollbar p-2",style:{"max-height":"88vh"},children:this.props.children})]})}}]),n}(i.a.Component),S=(n.p,n(23),"http://192.168.5.1/"),N="http://192.168.6.1/";function k(e){return new Promise((function(t,n){var s=function(e){return e.split(".").map((function(e){for(var t=parseInt(e),n=[],s=0;s<8;s++)n.push((t&1<<s)>>s);return n}))},a=function(t){for(var n=s(t.ip),a=s(t.subnet),i=[],r=0;r<4;r++)for(var c=0;c<8;c++)0==a[r][c]&&i.push([r,c]);for(var o=0;o<1<<i.length;o++){for(var l=0;l<i.length;l++)n[i[l][0]][i[l][1]]=0!=(1<<l&o)?1:0;for(var d=[],h=0;h<4;h++){for(var u=0,p=0;p<8;p++)u|=n[h][p]<<p;d.push(u)}e("http://"+d.join(".")+"/")}};networkinterface.getWiFiIPAddress((function(e){return t(a(e))}),(function(e){console.log(e),t(a({ip:"0.0.0.0",subnet:"255.255.255.255"}))}))}))}function y(){return new Promise((function(e,t){var n=function(e){for(var t=e.subnet.split(".").map((function(e){for(var t=parseInt(e),n=[],s=0;s<8;s++)n.push((t&1<<s)>>s);return n})),n=[],s=0;s<4;s++)for(var a=0;a<8;a++)0==t[s][a]&&n.push([s,a]);return 1<<n.length};networkinterface.getWiFiIPAddress((function(t){return e(n(t))}),(function(t){console.log(t),e(n({ip:"0.0.0.0",subnet:"255.255.255.255"}))}))}))}function C(e){var t,n;1===arguments.length&&(t=e.g,n=e.b,e=e.r);var s,a=Math.max(e,t,n),i=Math.min(e,t,n),r=a-i,c=0===a?0:r/a,o=a/255;switch(a){case i:s=0;break;case e:s=t-n+r*(t<n?6:0),s/=6*r;break;case t:s=n-e+2*r,s/=6*r;break;case n:s=e-t+4*r,s/=6*r}return{r:Math.round(255*s),g:Math.round(255*c),b:Math.round(255*o)}}function P(e){var t,n,s,a,i,r,c,o,l,d;switch(1===arguments.length&&(l=e.g,d=e.b,e=e.r),r=(d/=255)*(1-(l/=255)),c=d*(1-(i=6*(e/=255)-(a=Math.floor(6*e)))*l),o=d*(1-(1-i)*l),a%6){case 0:t=d,n=o,s=r;break;case 1:t=c,n=d,s=r;break;case 2:t=r,n=d,s=o;break;case 3:t=r,n=c,s=d;break;case 4:t=o,n=r,s=d;break;case 5:t=d,n=r,s=c}return{r:Math.round(255*t),g:Math.round(255*n),b:Math.round(255*s)}}function _(e){function t(e){return e>1?"s":""}var n=Math.floor(e/1e3),s=Math.floor(n/31536e3);if(s)return s+" year"+t(s);var a=Math.floor((n%=31536e3)/86400);if(a)return a+" day"+t(a);var i=Math.floor((n%=86400)/3600);if(i)return i+" hour"+t(i);var r=Math.floor((n%=3600)/60);if(r)return r+" minute"+t(r);var c=n%60;return c?c+" second"+t(c):"less than a second"}function D(e,t){return 0==t?e.master:e.devices[t-1]}function E(e,t){return new Promise((function(n,s){var a=setTimeout((function(){s(new Error("TIMEOUT"))}),e);t.then((function(e){clearTimeout(a),n(e)})).catch((function(e){clearTimeout(a),s(e)}))}))}function I(e){return{method:"post",body:new URLSearchParams(e).toString(),headers:{"Content-Type":"application/x-www-form-urlencoded",Origin:"",Referer:""}}}var T={method:"get",headers:{Origin:"",Referer:""}};function J(e){return e.length=="AutoGarden-XXXXXXXX".length&&"AutoGarden-"==e.substr(0,"AutoGarden-".length)}function M(e){try{return J(JSON.parse(e).boardname)}catch(t){return!1}}var G=100;function W(e){return e.moistureEnd<3995?e.moistureEnd-G:e.moistureBegin+G}function R(e){try{if(0==e.lowlighting.r&&0==e.lowlighting.g&&0==e.lowlighting.b&&0==e.highlighting.r&&0==e.highlighting.g&&0==e.highlighting.b)return!1}catch(t){}return!0}function F(e){try{return e.moistureBegin<4096}catch(t){}return!0}function A(e){var t=e.split("\n");return{code:parseInt(t.shift()),response:t.join("\n")}}var X={gardens:[{name:"New Garden",master:{master:!0,humanname:"AutoGarden-HEV1OE4M",boardname:"AutoGarden-HEV1OE4M",lastip:"http://192.168.1.181/",mac:"C4:4F:33:75:A7:31",connInfo:{connected:!0},settings:{boardname:"AutoGarden-HEV1OE4M",version:"0.1",isSlave:!1,hasWiFi:!0,moistureBegin:500,moistureEnd:2e3,checkingTime:1,cooldown:2,lightingtype:98,lowlighting:{r:255,g:0,b:0},highlighting:{r:0,g:0,b:255},lowvalue:100,highvalue:4096},readings:{moisture:0,temperature:0,sunlight:0},watering:{watering:!1,reason:"_",cooldownleft:-1}},devices:[{master:!1,humanname:"AutoGarden-ST31LMY3",boardname:"AutoGarden-ST31LMY3",lastip:null,mac:"C4:4F:33:75:7A:B1",connInfo:{connected:!0},settings:{boardname:"AutoGarden-ST31LMY3",version:"0.1",isSlave:!0,hasWiFi:!0,moistureBegin:5e3,moistureEnd:5e3,checkingTime:5,cooldown:60,lightingtype:115,lowlighting:{r:0,g:0,b:0},highlighting:{r:0,g:0,b:0},lowvalue:0,highvalue:4096},readings:{moisture:0,temperature:0,sunlight:0},watering:{watering:!1,reason:"_",cooldownleft:-1}}]}],networkSSID:"VFConnect",slide:"Home"},B=i.a.createContext(X);function L(e){return e.master.connInfo.connected}var U=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){return Object(f.a)(this,n),t.call(this,e)}return Object(b.a)(n,[{key:"render",value:function(){return Object(s.jsx)("div",{className:"header-box p-3",children:Object(s.jsxs)("div",{className:"row m-0 align-items-center h-100",children:[Object(s.jsx)("div",{className:"col-auto",children:Object(s.jsx)("h4",{className:"m-0",children:"AutoGarden v0.1"})}),Object(s.jsx)("div",{className:"col-auto ml-auto text-muted",children:Object(s.jsx)("i",{onClick:this.props.showSettings,className:"material-icons",children:"settings"})})]})})}}]),n}(i.a.Component);U.contextType=B;var K=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).updateConnInfo=s.updateConnInfo.bind(Object(g.a)(s)),s.updateSensorData=s.updateSensorData.bind(Object(g.a)(s)),s.changelightingmode=s.changelightingmode.bind(Object(g.a)(s)),s.startWatering=s.startWatering.bind(Object(g.a)(s)),s.stopWatering=s.stopWatering.bind(Object(g.a)(s)),s.saveMoistureSettings=s.saveMoistureSettings.bind(Object(g.a)(s)),s.saveLightingSettings=s.saveLightingSettings.bind(Object(g.a)(s)),s.saveAdvancedSettings=s.saveAdvancedSettings.bind(Object(g.a)(s)),s.delete=s.delete.bind(Object(g.a)(s)),s.datasync=i.a.createRef(),s.settingsCPS,s.popup=i.a.createRef(),s._flashref=i.a.createRef(),s.lightingposts=i.a.createRef(),s.moistureposts=i.a.createRef(),s.wateringposts=i.a.createRef(),s.advancedposts=i.a.createRef(),s.deletionpost=i.a.createRef(),s.state={settingsCPS:JSON.parse(JSON.stringify(s.props.device.settings))},s.datainterval=setInterval((function(){s.updateConnInfo()}),0==s.props.index?1e4:15e3),s.sensorinterval=0,s}return Object(b.a)(n,[{key:"componentWillUnmount",value:function(){console.log("UNMOUNTING"),clearInterval(this.datainterval),clearInterval(this.sensorinterval)}},{key:"updateConnInfo",value:function(){var e=this;if(console.log("conninfoupdated"),0==this.props.index)E(5e3,fetch(this.props.master.lastip+"settings",T).then((function(e){return e.text()})).then((function(t){console.log("fetchsuccess"),console.log(t),console.log(e.props.master),e.props.device.connInfo.connected=M(t)&&JSON.parse(t).boardname==e.props.master.boardname,e.props.master.settings=JSON.parse(t),e.props.updateDevice(e.props.device)}))).catch((function(t){console.log("errhere"),console.log(t),e.props.device.connInfo.connected=!1,e.props.updateDevice(e.props.device)})).finally((function(){console.log("flaadshededefe"),e._flashref.current.flash(),e.props.flashmaster()}));else{var t=function(t){return E(5e3,fetch(t+"forward",I({boardname:e.props.device.boardname,postjson:"null",post:"0",url:"/settings"}))).then((function(e){return e.text()})).then((function(e){return console.log(JSON.parse(A(e).response)),A(e).response})).catch((function(e){return!1}))};Promise.all([t(this.props.master.lastip),t(S),t(N)]).then((function(t){var n=function(t){return M(t)&&JSON.parse(t).boardname==e.props.device.boardname};if(console.log("inhereeeeeeee"),console.log(t),e.props.device.connInfo.connected=n(t[0])||n(t[1])||n(t[2]),e.props.device.connInfo.connected)for(var s=0;s<3;s++)n(t[s])&&(s,e.props.device.settings=JSON.parse(t[s]));e.props.updateDevice(e.props.device),e._flashref.current.flash(),e.props.flashmaster()}))}}},{key:"updateSensorData",value:function(){var e=this,t=this.props.index,n=function(t){console.log(t);var n=t.split("\n");e.props.device.readings.temperature=Math.round((parseFloat(n[0])-2500)/10)/10,e.props.device.readings.moisture=Math.min(100,Math.max(0,Math.round(parseFloat(n[1])/4095*100))),e.props.device.readings.sunlight=Math.min(100,Math.max(0,Math.round(parseFloat(n[2])/4095*100))),console.log(e.props.device.readings),e.props.device.watering.watering="watering"==n[4],e.props.device.watering.reason=n[5],e.props.device.watering.cooldownleft=parseFloat(n[6]),console.log(e.props.device.readings),e.datasync.current.flash(),e.props.updateDevice(e.props.device)};0==t?E(3e3,fetch(this.props.master.lastip+"sensordata",T)).then((function(e){return e.text()})).then((function(e){n(e)})):E(3e3,fetch(this.props.master.lastip+"forward",I({boardname:this.props.device.boardname,postjson:"null",post:"0",url:"/sensordata"}))).then((function(e){return e.text()})).then((function(e){return console.log(e),A(e).response})).then((function(e){n(e)}))}},{key:"changelightingmode",value:function(e){this.state.settingsCPS.lightingtype=parseInt(e.target.value),this.setState({settingsCPS:this.state.settingsCPS})}},{key:"startWatering",value:function(){var e=this;this.wateringposts.current.begin();var t={force:"1",for:"6"};E(5e3,0==this.props.index?fetch(e.props.master.lastip+"userwater",I(t)).then((function(e){return e.text()})):fetch(e.props.master.lastip+"forward",I({boardname:e.props.device.boardname,postjson:new URLSearchParams(t).toString(),post:"1",url:"/userwater"})).then((function(e){return e.text()})).then((function(e){return A(e).response}))).then((function(t){console.log(t),"OK"==t?e.wateringposts.current.succeed():e.wateringposts.current.fail()}))}},{key:"stopWatering",value:function(){var e=this;this.wateringposts.current.begin();var t={};E(5e3,0==this.props.index?fetch(e.props.master.lastip+"userstopwater",I(t)).then((function(e){return e.text()})):fetch(e.props.master.lastip+"forward",I({boardname:e.props.device.boardname,postjson:new URLSearchParams(t).toString(),post:"1",url:"/userstopwater"})).then((function(e){return e.text()})).then((function(e){return A(e).response}))).then((function(t){"OK"==t?e.wateringposts.current.succeed():e.wateringposts.current.fail()}))}},{key:"saveMoistureSettings",value:function(){var e=this;this.moistureposts.current.begin();var t={moistureBegin:this.state.settingsCPS.moistureBegin,moistureEnd:this.state.settingsCPS.moistureEnd};E(5e3,0==this.props.index?fetch(e.props.master.lastip+"moisturesettings",I(t)).then((function(e){return e.text()})):fetch(e.props.master.lastip+"forward",I({boardname:e.props.device.boardname,postjson:new URLSearchParams(t).toString(),post:"1",url:"/moisturesettings"})).then((function(e){return e.text()})).then((function(e){return A(e).response}))).then((function(n){"OK"==n?(e.moistureposts.current.succeed(),e.props.device.settings.moistureBegin=t.moistureBegin,e.props.device.settings.moistureEnd=t.moistureEnd,e.props.updateDevice(e.props.device)):e.moistureposts.current.fail()}))}},{key:"saveAdvancedSettings",value:function(){var e=this;this.advancedposts.current.begin();var t={checkingTime:this.state.settingsCPS.checkingTime,cooldown:this.state.settingsCPS.cooldown};E(5e3,0==this.props.index?fetch(e.props.master.lastip+"advancedsettings",I(t)).then((function(e){return e.text()})):fetch(e.props.master.lastip+"forward",I({boardname:e.props.device.boardname,postjson:new URLSearchParams(t).toString(),post:"1",url:"/advancedsettings"})).then((function(e){return e.text()})).then((function(e){return A(e).response}))).then((function(n){"OK"==n?(e.advancedposts.current.succeed(),e.props.device.settings.checkingTime=t.checkingTime,e.props.device.settings.cooldown=t.cooldown,e.props.updateDevice(e.props.device)):e.advancedposts.current.fail()}))}},{key:"saveLightingSettings",value:function(){var e=this;this.lightingposts.current.begin();var t=this.state.settingsCPS.moistureBegin,n=this.state.settingsCPS.moistureEnd,s="b";switch(this.state.settingsCPS.lightingtype){case 97:t=100,n=4e3,s="a";break;case 99:t=100,n=4e3,s="c"}var a={lightingtype:s,lowvalue:t,highvalue:n,lowlightingr:this.state.settingsCPS.lowlighting.r,lowlightingg:this.state.settingsCPS.lowlighting.g,lowlightingb:this.state.settingsCPS.lowlighting.b,highlightingr:this.state.settingsCPS.highlighting.r,highlightingg:this.state.settingsCPS.highlighting.g,highlightingb:this.state.settingsCPS.highlighting.b};E(5e3,0==this.props.index?fetch(e.props.master.lastip+"lightsettings",I(a)).then((function(e){return e.text()})):fetch(e.props.master.lastip+"forward",I({boardname:e.props.device.boardname,postjson:new URLSearchParams(a).toString(),post:"1",url:"/lightsettings"})).then((function(e){return e.text()})).then((function(e){return A(e).response}))).then((function(s){"OK"==s?(e.lightingposts.current.succeed(),e.props.device.settings.lowlighting=JSON.parse(JSON.stringify(e.state.settingsCPS.lowlighting)),e.props.device.settings.highlighting=JSON.parse(JSON.stringify(e.state.settingsCPS.highlighting)),e.props.device.settings.lowvalue=t,e.props.device.settings.highvalue=n,e.props.updateDevice(e.props.device)):e.lightingposts.current.fail()}))}},{key:"delete",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t,n,s,a,i,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("exect"),this.setState({finished:!1,error:""}),this.deletionpost.current.begin(),console.log("eibe"),e.prev=4,console.log("topfrag"),e.next=8,E(4e3,fetch(this.props.master.lastip+"devices",T)).then((function(e){return e.text()}));case 8:t=e.sent,console.log(t),console.log("eibeennenen"),(n=t.split("\n")).pop(),console.log(n),s=0;case 15:if(!(s<n.length)){e.next=30;break}if(a=n[s],i=a.split(" "),console.log(a),i[0].slice(0,-1)!=this.props.device.mac){e.next=27;break}return console.log("erioeobg"),e.next=23,E(4e3,fetch(this.props.master.lastip+"removedevice",I({boardidx:s}))).then((function(e){return e.text()}));case 23:if(r=e.sent,console.log(r),"OK"==r){e.next=27;break}throw Error("removal failed");case 27:s++,e.next=15;break;case 30:c=JSON.parse(JSON.stringify(this.context.gardens)),console.log(this.props.idx),console.log(JSON.stringify(c[this.props.idx].devices)),c[this.props.idx].devices.splice(this.props.index-1,1),console.log(this.props.index-1),console.log(JSON.stringify(c[this.props.idx].devices)),console.log(JSON.stringify(c)),console.log("going darl"),this.props.updateGardens(c),e.next=45;break;case 41:e.prev=41,e.t0=e.catch(4),console.log(e.t0),this.deletionpost.current.fail();case 45:case"end":return e.stop()}}),e,this,[[4,41]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.device;return Object(s.jsxs)("div",{className:"ag-collapse "+(this.props.visible?"":"ag-collapsed"),children:[Object(s.jsxs)(w,{ref:this.popup,shown:function(){e.updateSensorData(),e.sensorinterval=setInterval((function(){console.log("heifhef"),e.updateSensorData()}),6e3)},hidden:function(){clearInterval(e.datainterval)},children:[Object(s.jsxs)("h5",{children:[Object(s.jsx)(x,{value:t.humanname,update:function(t){e.props.device.humanname=t,e.props.updateDevice(e.props.device)}})," ",Object(s.jsx)(O,{icon:"sync",ref:this.datasync})]}),Object(s.jsxs)("div",{className:"row m-0 no-gutters",children:[Object(s.jsxs)("div",{className:"col-4 text-center",children:[Object(s.jsx)("b",{children:"Moisture"}),Object(s.jsx)("p",{className:"m-0 p-2",children:Object(s.jsx)("i",{className:"material-icons sensoricon font-size-large water-icon",style:{color:"hsl(200, 100%, "+t.readings.moisture/2+"%)"},children:"location_on"})}),Object(s.jsxs)("p",{children:[t.readings.moisture,"%"]})]}),Object(s.jsxs)("div",{className:"col-4 text-center",children:[Object(s.jsx)("b",{children:"Sunlight"}),Object(s.jsx)("p",{className:"m-0 p-2",children:Object(s.jsxs)("i",{className:"material-icons sensoricon font-size-large",style:{color:"hsl(55, 100%, "+t.readings.sunlight/2+"%)"},children:["brightness_",Math.round(t.readings.sunlight/16.67)+1]})}),Object(s.jsxs)("p",{children:[t.readings.sunlight,"%"]})]}),Object(s.jsxs)("div",{className:"col-4 text-center",children:[Object(s.jsx)("b",{children:"Temperature"}),Object(s.jsx)("p",{className:"m-0 p-2",children:Object(s.jsx)("i",{className:"material-icons sensoricon font-size-large",style:{color:"hsl(35, 100%, "+Math.min(100,Math.max(0,1.42857143*(t.readings.temperature+5)))+"%)"},children:"wb_sunny"})}),Object(s.jsxs)("p",{children:[t.readings.temperature,"\xb0C"]})]})]}),Object(s.jsx)("br",{}),Object(s.jsxs)("p",{className:t.watering.watering?"text-info":"",children:[t.watering.watering?"Watering":"Not watering",Object(s.jsx)("br",{}),Object(s.jsx)("button",{className:"btn btn-primary",onClick:function(){e.startWatering()},children:"Begin watering for 6s"}),Object(s.jsx)("br",{})," ",Object(s.jsx)("button",{className:"btn btn-dark",onClick:function(){e.stopWatering()},children:"Stop watering"})," ",Object(s.jsx)(v,{ref:this.wateringposts})]}),t.watering.cooldownleft>0?Object(s.jsx)("p",{children:"Watered recently, won't water automatically for "+_(t.watering.cooldownleft/1e3)}):null,Object(s.jsx)("br",{}),Object(s.jsx)("h6",{children:"Watering settings"}),Object(s.jsx)("p",{children:"Drag the slider to choose a moisture level to maintain for your plants. "}),Object(s.jsxs)("p",{children:["Automatically water? ",Object(s.jsx)("input",{checked:F(this.state.settingsCPS),className:"d-inline-block",type:"checkbox",onChange:function(t){t.target.checked?(e.state.settingsCPS.moistureBegin=1900,e.state.settingsCPS.moistureEnd=2100):(e.state.settingsCPS.moistureBegin=5e3,e.state.settingsCPS.moistureEnd=0),e.setState({settingsCPS:e.state.settingsCPS})}})]}),Object(s.jsxs)("div",{className:F(this.state.settingsCPS)?"":"div-disabled",children:[Object(s.jsx)("input",{class:"wateringslider",type:"range",min:"0",max:"4095",value:W(this.state.settingsCPS),onChange:function(t){e.state.settingsCPS.moistureBegin=Math.max(0,parseInt(t.target.value)-G),e.state.settingsCPS.moistureEnd=Math.min(4096,parseInt(t.target.value)+G),e.setState({settingsCPS:e.state.settingsCPS})}}),Object(s.jsx)("p",{}),Object(s.jsxs)("p",{children:[Object(s.jsx)("span",{children:"100% - fully wet"}),Object(s.jsx)("span",{className:"float-right",children:"fully dry - 0%"})]}),Object(s.jsxs)("p",{children:["Current setting: ",Math.round(W(this.state.settingsCPS)/40.96)]})]}),Object(s.jsx)("button",{onClick:function(){e.saveMoistureSettings()},className:"btn btn-primary "+(t.connInfo.connected?"":"disabled"),children:"Save watering settings"})," ",Object(s.jsx)(v,{ref:this.moistureposts}),Object(s.jsx)("p",{}),Object(s.jsx)("h6",{children:"Lighting settings"}),Object(s.jsx)("p",{children:"Control the colour of the lights on the device based on current sensor readings."}),Object(s.jsxs)("p",{children:["Turn lights on? ",Object(s.jsx)("input",{checked:R(this.state.settingsCPS),className:"d-inline-block",type:"checkbox",onChange:function(t){t.target.checked?(e.state.settingsCPS.lowlighting={r:255,g:0,b:0},e.state.settingsCPS.highlighting={r:255,g:0,b:0}):(e.state.settingsCPS.lowlighting={r:0,g:0,b:0},e.state.settingsCPS.highlighting={r:0,g:0,b:0}),e.setState({settingsCPS:e.state.settingsCPS})}})]}),Object(s.jsxs)("div",{className:R(this.state.settingsCPS)?"":"div-disabled",children:[Object(s.jsx)("p",{children:"Change lighting based on: "}),Object(s.jsx)("input",{className:"m-1",type:"radio",name:t.boardname,value:98,onChange:function(t){e.changelightingmode(t)},checked:98==this.state.settingsCPS.lightingtype}),Object(s.jsx)("label",{children:"Moisture"})," ",Object(s.jsx)("br",{}),Object(s.jsx)("input",{className:"m-1",type:"radio",name:t.boardname,value:97,onChange:function(t){e.changelightingmode(t)},checked:97==this.state.settingsCPS.lightingtype}),Object(s.jsx)("label",{children:"Sunlight"})," ",Object(s.jsx)("br",{}),Object(s.jsx)("input",{className:"m-1",type:"radio",name:t.boardname,value:99,onChange:function(t){e.changelightingmode(t)},checked:99==this.state.settingsCPS.lightingtype}),Object(s.jsx)("label",{children:"Temperature"})," ",Object(s.jsx)("br",{}),Object(s.jsxs)("p",{children:["Color when ",function(){switch(e.state.settingsCPS.lightingtype){case 98:return"dry";case 97:return"dark";default:return"cold"}}()]}),Object(s.jsx)("input",{className:"hueslider",type:"range",min:"0",max:"255",value:C(this.state.settingsCPS.lowlighting).r,onChange:function(t){e.state.settingsCPS.lowlighting=P({r:parseInt(t.target.value),g:255,b:255}),e.setState({settingsCPS:e.state.settingsCPS})}}),Object(s.jsx)("br",{}),Object(s.jsxs)("p",{children:["Color when ",function(){switch(e.state.settingsCPS.lightingtype){case 98:return"wet";case 97:return"sunny";default:return"hot"}}()]}),Object(s.jsx)("input",{className:"hueslider",type:"range",min:"0",max:"255",value:C(this.state.settingsCPS.highlighting).r,onChange:function(t){e.state.settingsCPS.highlighting=P({r:parseInt(t.target.value),g:255,b:255}),e.setState({settingsCPS:e.state.settingsCPS})}}),Object(s.jsx)("br",{})]}),Object(s.jsx)("p",{}),Object(s.jsx)("button",{onClick:function(){e.saveLightingSettings()},className:"btn btn-primary "+(t.connInfo.connected?"":"disabled"),children:"Save lighting settings"})," ",Object(s.jsx)(v,{ref:this.lightingposts}),Object(s.jsx)("p",{})," ",Object(s.jsx)("h6",{children:"Advanced settings"}),Object(s.jsxs)("p",{children:["How long (in minutes) should the device wait for a stable reading before beginning to water? ",Object(s.jsx)("input",{type:"number",onChange:function(t){e.state.settingsCPS.checkingTime=t.target.value,e.setState({settingsCPS:e.state.settingsCPS})},value:this.state.settingsCPS.checkingTime})]}),Object(s.jsxs)("p",{children:["How long (in minutes) should the device wait in between consecutive waterings? ",Object(s.jsx)("input",{type:"number",onChange:function(t){e.state.settingsCPS.cooldown=t.target.value,e.setState({settingsCPS:e.state.settingsCPS})},value:this.state.settingsCPS.cooldown})]}),Object(s.jsx)("p",{}),Object(s.jsx)("button",{onClick:function(){e.saveAdvancedSettings()},className:"btn btn-primary "+(t.connInfo.connected?"":"disabled"),children:"Save advanced settings"})," ",Object(s.jsx)(v,{ref:this.advancedposts}),Object(s.jsx)("p",{}),Object(s.jsx)("p",{}),0==this.props.index?null:Object(s.jsxs)("div",{children:[Object(s.jsx)("h6",{children:"Delete this device"}),Object(s.jsxs)("p",{children:[Object(s.jsx)("button",{className:"btn btn-danger",onClick:function(){e.delete()},children:"Delete this device"})," ",Object(s.jsx)(v,{ref:this.deletionpost})]})]})]}),Object(s.jsxs)("div",{className:"row m-0 p-3 align-items-center",onClick:function(){e.popup.current.showPopup()},children:[Object(s.jsx)("div",{className:"col-1"}),Object(s.jsx)("div",{className:"col-auto",children:Object(s.jsx)("i",{className:"material-icons font-size-large "+(t.connInfo.connected?"text-success":"text-danger"),children:"local_florist"})}),Object(s.jsxs)("div",{className:"col-auto",children:[Object(s.jsx)("span",{children:Object(s.jsx)("b",{children:t.humanname})}),Object(s.jsx)("br",{}),Object(s.jsx)("span",{children:Object(s.jsxs)("small",{className:"text-muted",children:["(",t.boardname,") ",t.master?Object(s.jsx)("span",{className:"text-primary",children:"(main)"}):""]})}),Object(s.jsxs)("p",{children:[Object(s.jsx)("span",{className:this.props.device.connInfo.connected?"text-success":"text-danger",children:(this.props.device.connInfo.connected?"Connected":"Not found")+" "}),Object(s.jsx)(O,{ref:this._flashref,icon:"sync"})]})]})]})]},"index")}}]),n}(i.a.Component);K.contextType=B;var z=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var s;return Object(f.a)(this,n),(s=t.call(this,e)).state={visible:!1,addNewDeviceStage:"connslave",boardname:null,mac:null,settings:{},error:"",boardip:"",finished:!1,masterpassword:"",searchfounds:0,searchnum:0},s.setupconnslave=s.setupconnslave.bind(Object(g.a)(s)),s.setuprstslave=s.setuprstslave.bind(Object(g.a)(s)),s.setupaddtomaster=s.setupaddtomaster.bind(Object(g.a)(s)),s.search=s.search.bind(Object(g.a)(s)),s._editGardenPopup=i.a.createRef(),s._masterflashref=i.a.createRef(),s._connslavepost=i.a.createRef(),s._rstslavepost=i.a.createRef(),s._addtomasterpost=i.a.createRef(),s}return Object(b.a)(n,[{key:"componentWillUnmount",value:function(){clearInterval(this.gardeninterval)}},{key:"search",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,y();case 3:e.t1=e.sent,e.t2={searchingfound:!1,searching:!0,searchfounds:0,searchnum:e.t1},e.t3=function(){k((function(e){console.log(e),fetch(e,T).then((function(e){return e.text()})).then((function(n){if(console.log(t.props.garden.master.boardname),console.log(n),t.props.garden.master.boardname==n){var s=t.context.gardens;console.log(e),s[t.props.idx].master.lastip=e,console.log("FOUND"),console.log(s),t.props.updateGardens(s),t.setState({searchingfound:!0})}})).catch((function(e){return console.log(e)})).finally((function(){t.setState((function(e,t){return{searchfounds:e.searchfounds+1}}))}))}))},e.t0.setState.call(e.t0,e.t2,e.t3);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setupconnslave",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t,n,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._connslavepost.current.begin(),t=E(4e3,fetch(S+"settings",T).then((function(e){return e.text()}))).catch((function(e){return console.log("5nocon"),"NOCONN"})),n=E(4e3,fetch(N+"settings",T).then((function(e){return e.text()}))).catch((function(e){return console.log("6nocon"),"NOCONN"})),Promise.all([t,n]).then((function(e){var t;console.log(s.context.gardens),console.log(e);var n=!1;M(e[0])?(s.setState({boardname:JSON.parse(e[0]).boardname,settings:JSON.parse(e[0])}),t=S,n=!0):M(e[1])?(s.setState({boardname:JSON.parse(e[1]).boardname,settings:JSON.parse(e[1])}),t=N,n=!0):s._connslavepost.current.fail(),n&&fetch(t+"mac",T).then((function(e){return e.text()})).then(function(){var e=Object(p.a)(u.a.mark((function e(n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(s.state),console.log(s.state.masterpassword),e.next=4,E(4e3,fetch(t+"setwifi",I({ssid:s.props.garden.master.boardname,password:s.state.masterpassword}))).then((function(e){return e.text()}));case 4:if(a=e.sent,console.log({ssid:s.props.garden.master.boardname,password:s.state.masterpassword}),console.log(a),"OK"==a){e.next=9;break}throw Error("no ok");case 9:setTimeout((function(){fetch(t+"connected",T).then((function(e){return e.text()})).then((function(e){console.log(e),"YES"==e?(s._connslavepost.current.reset(),s.setState({mac:n,addNewDeviceStage:"rstslave",boardip:t})):s._connslavepost.current.fail()}))}),4e3);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log(e),s._connslavepost.current.fail()})),console.log(s.context.gardens)})).catch((function(e){console.log(e),s._connslavepost.current.fail()}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setuprstslave",value:function(){var e=this;this._rstslavepost.current.begin(),E(5e3,fetch(this.state.boardip+"setstate",I({isSlave:"1"}))).finally((function(){e._rstslavepost.current.reset(),e.setState({addNewDeviceStage:"addtomaster"})}))}},{key:"setupaddtomaster",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t,n,s,a,i,r,c,o,l,d,h,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({finished:!1,error:""}),this._addtomasterpost.current.begin(),e.prev=2,console.log(this.context.gardens),t=!0,e.next=7,E(15e3,fetch(this.context.gardens[this.props.idx].master.lastip+"devices",T)).then((function(e){return e.text()}));case 7:n=e.sent,(s=n.split("\n")).pop(),console.log(s),a=0;case 12:if(!(a<s.length)){e.next=30;break}if(i=s[a],(r=i.split(" "))[0].slice(0,-1)!=this.state.mac){e.next=27;break}if(r[1]!=this.state.boardname){e.next=21;break}this.setState({finished:!0,error:"Device already added!"}),t=!1,e.next=27;break;case 21:return e.next=23,E(15e3,fetch(this.context.gardens[this.props.idx].master.lastip+"removedevice",I({boardidx:a}))).then((function(e){return e.text()}));case 23:if(c=e.sent,console.log(c),"OK"==c){e.next=27;break}throw Error("removal failed");case 27:a++,e.next=12;break;case 30:if(!(s.length>4)){e.next=33;break}throw this.setState({finished:!1,error:"Only 4 devices can be connected to this valve."}),Error("too many devices");case 33:if(!t){e.next=40;break}return e.next=36,E(15e3,fetch(this.context.gardens[this.props.idx].master.lastip+"adddevice",I({boardname:this.state.boardname,macaddress:this.state.mac}))).then((function(e){return e.text()}));case 36:if(o=e.sent,console.log(o),"OK"==o){e.next=40;break}throw Error("addition failed");case 40:l=!1,console.log(this.context.gardens),d=JSON.parse(JSON.stringify(this.context.gardens[this.props.idx].devices)),h={master:!1,humanname:this.state.boardname,boardname:this.state.boardname,lastip:null,mac:this.state.mac,connInfo:{connected:!1},settings:this.state.settings,readings:{moisture:0,temperature:0,sunlight:0},watering:{watering:!1,reason:"_",cooldownleft:-1}},p=0;case 45:if(!(p<d.length)){e.next=53;break}if(d[p].mac!=this.state.mac){e.next=50;break}return d[p]=JSON.parse(JSON.stringify(h)),l=!0,e.abrupt("break",53);case 50:p++,e.next=45;break;case 53:l||(d.push(JSON.parse(JSON.stringify(h))),console.log("hiuwb")),this.context.gardens[this.props.idx].devices=d,console.log(this.context.gardens),this.props.updateGardens(this.context.gardens),this.setState({finished:!0}),this._addtomasterpost.current.succeed(),e.next=65;break;case 61:e.prev=61,e.t0=e.catch(2),console.log(e.t0),this._addtomasterpost.current.fail();case 65:case"end":return e.stop()}}),e,this,[[2,61]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return Object(s.jsxs)("div",{className:"garden-row",children:[Object(s.jsxs)("div",{className:"row m-0 align-items-center p-3",children:[Object(s.jsx)("div",{className:"col-auto",onClick:function(){e.updateConnInfo(),e._editGardenPopup.current.showPopup()},children:Object(s.jsx)("i",{className:"material-icons font-size-large "+(L(this.props.garden)?"text-success":"text-danger"),children:"grass"})}),Object(s.jsxs)("div",{className:"col-auto mr-auto",onClick:function(){e._editGardenPopup.current.showPopup()},children:[Object(s.jsxs)("h6",{children:[this.props.garden.name," ",Object(s.jsx)("i",{className:"material-icons",children:"edit"})]}),Object(s.jsx)("p",{className:"m-0",children:L(this.props.garden)?Object(s.jsx)("span",{className:"text-success",children:"Connected"}):Object(s.jsx)("span",{className:"text-danger",children:"Not found"})})]}),Object(s.jsx)("div",{className:"col-auto",onClick:function(){e.setState({visible:!e.state.visible})},children:Object(s.jsx)("i",{className:"material-icons font-size-large text-primary dropdown-icon "+(this.state.visible?"dropdown-icon-rotate":""),children:"keyboard_arrow_right"})})]}),[this.props.garden.master].concat(Object(d.a)(this.props.garden.devices)).map((function(t,n){var a;return Object(s.jsx)(K,(a={visible:e.state.visible,device:D(e.context.gardens[e.props.idx],n),updateGardens:e.props.updateGardens,index:n,master:e.context.gardens[e.props.idx].master,updateDevice:function(t){0==n?e.context.gardens[e.props.idx].master=t:e.context.gardens[e.props.idx].devices[n-1]=t,e.props.updateGardens(e.context.gardens)},flashmaster:function(){console.log("????"),e._masterflashref.current.flash()}},Object(l.a)(a,"updateGardens",e.props.updateGardens),Object(l.a)(a,"idx",e.props.idx),a),n)})),Object(s.jsxs)(w,{ref:this._editGardenPopup,shown:function(){e.setState({addNewDeviceStage:""})},children:[Object(s.jsx)("h5",{children:Object(s.jsx)(x,{value:this.props.garden.name,update:function(t){var n=e.context.gardens;console.log(e.context),console.log(e.props.idx),n[e.props.idx].name=t,e.props.updateGardens(n)}})}),Object(s.jsx)("br",{}),Object(s.jsxs)("p",{children:["Connection status: ",Object(s.jsx)("span",{className:this.props.garden.master.connInfo.connected?"text-success":"text-danger",children:(this.props.garden.master.connInfo.connected?"Connected":"Not found")+" "}),Object(s.jsx)(O,{ref:this._masterflashref,icon:"sync"})]}),Object(s.jsx)("p",{children:"If you have changed network (like when you have finished setting this device up) or if you cannot access the device, you can try searching for it."}),Object(s.jsx)("button",{className:"btn btn-primary",onClick:this.search,children:"Search for the device"}),this.state.searching?Object(s.jsxs)("p",{children:["Searching... (",this.state.searchfounds,"/",this.state.searchnum,")"]}):null,this.state.searchingfound?Object(s.jsx)("p",{children:"Found!"}):null,Object(s.jsx)("p",{}),Object(s.jsx)("button",{className:"btn btn-danger",onClick:function(){var t=e.context.gardens;t.splice(e.props.idx,1),e.props.updateGardens(t)},children:"Delete"}),Object(s.jsx)("p",{children:"Deleting the device will not turn it off - you can still re-add it if it is turned on."}),Object(s.jsx)("p",{}),Object(s.jsx)("h6",{children:"Add a new device to this garden"}),function(){switch(e.state.addNewDeviceStage){case"connslave":return Object(s.jsxs)("div",{children:[Object(s.jsx)("p",{children:"Connect to the WiFi network of the device that you want to add"}),Object(s.jsx)("p",{children:'Your WiFi network should look like "AutoGarden-XXXXXXXX"'}),Object(s.jsx)("p",{children:"Enter the password of the main board of this garden below"}),Object(s.jsx)("p",{children:Object(s.jsx)("input",{onChange:function(t){e.setState({masterpassword:t.target.value})}})}),Object(s.jsx)("p",{}),Object(s.jsx)("button",{className:"btn btn-primary",onClick:e.setupconnslave,children:"Connect"})," ",Object(s.jsx)(v,{ref:e._connslavepost}),Object(s.jsx)("p",{}),Object(s.jsx)("button",{className:"btn btn-primary",onClick:function(){e.setState({addNewDeviceStage:"rstslave"})},children:"Next"})]});case"rstslave":return Object(s.jsxs)("div",{children:[Object(s.jsx)("p",{children:"The device may need to restart to set up"}),Object(s.jsx)("p",{}),Object(s.jsx)("button",{className:"btn btn-primary",onClick:e.setuprstslave,children:"Update"})," ",Object(s.jsx)(v,{ref:e._rstslavepost})]});case"addtomaster":return Object(s.jsxs)("div",{children:[Object(s.jsx)("p",{children:"Now, connect back to your original network. This garden should be connected."}),Object(s.jsx)("p",{children:"Then, press the button below to finish the process."}),Object(s.jsx)("p",{}),Object(s.jsx)("button",{className:"btn btn-primary",onClick:e.setupaddtomaster,children:"Finish"})," ",Object(s.jsx)(v,{ref:e._addtomasterpost}),Object(s.jsx)("p",{}),e.state.finished?Object(s.jsx)("p",{children:"All done! Close this window to manage your device."}):null,Object(s.jsx)("p",{children:e.state.error})]});default:e.setState({addNewDeviceStage:"connslave",boardname:null,mac:null,settings:{},error:"",boardip:"",finished:!1})}}()]})]})}}]),n}(i.a.Component);z.contextType=B;var Y=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){return Object(f.a)(this,n),t.call(this,e)}return Object(b.a)(n,[{key:"render",value:function(){var e=this;return Object(s.jsx)("div",{className:"main-box",children:this.context.gardens.map((function(t,n){return Object(s.jsx)(z,{updateGardens:e.props.updateGardens,garden:t,idx:n},n)}))})}}]),n}(i.a.Component);Y.contextType=B;var H=function(e){Object(j.a)(n,e);var t=Object(m.a)(n);function n(e){var s;Object(f.a)(this,n),s=t.call(this,e);var a=window.localStorage,r=a.getItem("settings");return null==r&&(a.setItem("settings",JSON.stringify({gardens:[]})),r=a.getItem("settings")),s._addDevicePopup=i.a.createRef(),s.search=s.search.bind(Object(g.a)(s)),s.addBoard=s.addBoard.bind(Object(g.a)(s)),s.updateGardens=s.updateGardens.bind(Object(g.a)(s)),s.setupConnectTo=s.setupConnectTo.bind(Object(g.a)(s)),s.setupWifiSettings=s.setupWifiSettings.bind(Object(g.a)(s)),s.finishSetup=s.finishSetup.bind(Object(g.a)(s)),s.searchEnabledTimeout=null,s._wifisetupflash=i.a.createRef(),s.setState=s.setState.bind(Object(g.a)(s)),s.wificheckinterval,s.state={searchEnabled:!0,searchbegun:!1,searchfounds:0,searchnum:0,addDeviceDivVisible:!1,addDeviceSearch:!1,addDeviceNew:!1,addDeviceStage:"checkconnectingmaster",connecting:!1,wentwrong:!1,localip:null,sendingwififailed:!1,wifiname:"",wifipwd:"",sendingrestart:!1,complete:!1,bname:"",settingsdoc:{},searchResults:[],ctx:JSON.parse(r),boardbeingadded:null,boardbeingaddedErr:!1,boardbeingaddedSuccess:!1,retrievedData:{}},s}return Object(b.a)(n,[{key:"saveState",value:function(){window.localStorage.setItem("settings",JSON.stringify(this.state.ctx)),console.log(this.state.ctx)}},{key:"updateGardens",value:function(e){var t=this;console.log(e),this.state.ctx.gardens=e,console.log(this.state.ctx),this.setState({ctx:this.state.ctx},(function(){console.log(t.state.ctx),t.saveState()}))}},{key:"search",value:function(){var e=Object(p.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.searchEnabled){e.next=10;break}return e.t0=this,e.t1=[],e.t2=setTimeout((function(){t.setState({searchEnabled:!0})}),5e3),e.next=6,y();case 6:e.t3=e.sent,e.t4={searchResults:e.t1,searchEnabled:!1,searchEnabledTimeout:e.t2,searchnum:e.t3,searchbegun:!0,searchfounds:0},e.t0.setState.call(e.t0,e.t4),k((function(e){console.log(e),fetch(e,T).then((function(e){return e.text()})).then((function(n){J(n)&&t.setState((function(s,a){var i=t.state.searchResults;return i.push({boardname:n,ip:e}),{searchResults:i}}))})).catch((function(e){return console.log(e)})).finally((function(){t.setState((function(e,t){return{searchfounds:e.searchfounds+1}}))}))}));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setLED",value:function(e){E(5e3,fetch(e+"setlighting",I({r:255,g:123,b:0,time:7}))).then((function(e){return e.text()})).then((function(e){console.log(e)}))}},{key:"componentWillUnmount",value:function(){clearTimeout(this.searchEnabledTimeout)}},{key:"addBoard",value:function(){var e=Object(p.a)(u.a.mark((function e(t,n){var s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({boardbeingadded:t,retrievedData:{},boardbeingaddedErr:!1,boardbeingaddedSuccess:!1}),e.prev=1,e.delegateYield(u.a.mark((function e(){var t,a,i,r,c,l,d,h,p,g,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(15e3,fetch(n+"settings",T)).then((function(e){return e.text()}));case 2:return t=e.sent,e.next=5,E(15e3,fetch(n+"mac",T)).then((function(e){return e.text()}));case 5:return a=e.sent,e.next=8,E(15e3,fetch(n+"devices",T)).then((function(e){return e.text()}));case 8:i=e.sent,r=[t,a,i],console.log(r),c={master:!0,humanname:JSON.parse(r[0]).boardname,boardname:JSON.parse(r[0]).boardname,lastip:n,mac:r[1].toUpperCase(),connInfo:{connected:!0},settings:JSON.parse(r[0]),readings:{moisture:0,temperature:0,sunlight:0},watering:{watering:!1,reason:"_",cooldownleft:-1}},l=[],d=r[2].split("\n"),h=[],d.pop(),p=Object(o.a)(d);try{for(f=function(){var e=g.value.split(" "),t=e[0].slice(0,-1).toUpperCase(),s=e[1];h.push(E(15e3,fetch(n+"forward",I({boardname:s,postjson:"null",post:"0",url:"/settings"}))).then((function(e){return e.text()})).then((function(e){console.log(e),l.push({master:!1,humanname:s,boardname:s,lastip:null,mac:t,connInfo:{connected:M(A(e).response)},settings:JSON.parse(A(e).response),readings:{moisture:0,temperature:0,sunlight:0},watering:{watering:!1,reason:"_",cooldownleft:-1}})})).catch((function(e){console.log(e),l.push({master:!1,humanname:s,boardname:s,lastip:null,mac:t,connInfo:{connected:!1},settings:{},readings:{moisture:0,temperature:0,sunlight:0},watering:{watering:!1,reason:"_",cooldownleft:-1}})})))},p.s();!(g=p.n()).done;)f()}catch(u){p.e(u)}finally{p.f()}Promise.all(h).then((function(e){s.state.ctx.gardens.push({name:"New Garden",master:c,devices:l}),console.log(JSON.stringify(s.state)),s.setState({ctx:s.state.ctx,boardbeingaddedSuccess:!0},(function(){s.saveState()}))}));case 19:case"end":return e.stop()}}),e)}))(),"t0",3);case 3:e.next=9;break;case 5:e.prev=5,e.t1=e.catch(1),console.log(e.t1),this.setState({boardbeingaddedErr:!0});case 9:case"end":return e.stop()}}),e,this,[[1,5]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setupConnectTo",value:function(){var e=this,t=E(1e4,fetch(S+"settings",T).then((function(e){return e.text()}))).catch((function(e){return console.log("5nocon"),"NOCONN"})),n=E(1e4,fetch(N+"settings",T).then((function(e){return e.text()}))).catch((function(e){return console.log("6nocon"),"NOCONN"}));Promise.all([t,n]).then((function(t){console.log(t),M(t[0])?e.setState({localip:S,connecting:!1,bname:JSON.parse(t[0]).boardname,settingsdoc:JSON.parse(t[0]),addDeviceStage:"setupmaster1"}):M(t[1])?e.setState({localip:N,connecting:!1,bname:JSON.parse(t[1]).boardname,settingsdoc:JSON.parse(t[1]),addDeviceStage:"setupmaster1"}):e.setState({wentwrong:!0,connecting:!1})})),this.setState({connecting:!0,wentwrong:!1})}},{key:"setupWifiSettings",value:function(){var e=this;console.log(this.state),fetch(this.state.localip+"setwifi",I({ssid:this.state.wifiname,password:this.state.wifipwd})).then((function(e){return e.text()})).then((function(t){e.setState({sentwifi:!0,wifistatusnoconn:!0}),setTimeout((function(){fetch(e.state.localip+"connected",T).then((function(e){return e.text()})).then((function(t){console.log(t),"YES"==t?e.setState({wifistatusconn:!0,wifistatusnoconn:!1}):e.setState({wifistatusconn:!1,wifistatusnoconn:!0}),e._wifisetupflash.current.flash()}))}),4e3)})).catch((function(t){console.log(t),e.setState({sendingwififailed:!0})})),this.setState({sendingwifi:!0,sendingwififailed:!1,sentwifi:!1,wifistatusconn:!1,wifistatusnoconn:!1})}},{key:"finishSetup",value:function(){var e=this;this.setState({sendingrestart:!0}),fetch(this.state.localip+"setstate",I({isSlave:"0"})).finally((function(){e.setState({complete:!0}),e.state.ctx.gardens.push({name:"New Garden",master:{master:!0,humanname:e.state.bname,boardname:e.state.bname,lastip:"http://errresolve/",mac:"_",connInfo:{connected:!0},settings:e.state.settingsdoc,readings:{moisture:0,temperature:0,sunlight:0},watering:{watering:!1,reason:"_",cooldownleft:-1}},devices:[]}),e.saveState(),e.setState({ctx:e.state.ctx})}))}},{key:"render",value:function(){var e=this,t=this.state.ctx;console.log(this.props.networkinterface),t.networkinterface=this.props.networkinterface;var n=this.state.addDeviceSearch?Object(s.jsxs)("div",{className:"container p-2",children:[Object(s.jsx)("div",{className:"row",children:Object(s.jsxs)("div",{className:"col-12",children:[Object(s.jsx)("h6",{children:"Search for devices"}),Object(s.jsx)("button",{className:"btn btn-primary w-100 "+(this.state.searchEnabled?"":"disabled"),onClick:this.search,children:"Search"})]})}),this.state.searchbegun?Object(s.jsxs)("p",{children:["Searching... (",this.state.searchfounds,"/",this.state.searchnum,")"]}):null,this.state.searchResults.map((function(t,n){return Object(s.jsxs)("div",{className:"row",children:[Object(s.jsx)("div",{className:"col-auto p-2",children:Object(s.jsx)("p",{children:t.boardname})}),Object(s.jsxs)("div",{className:"col-auto ml-auto p-2",children:[Object(s.jsx)("button",{className:"btn btn-warning",onClick:function(){e.setLED(t.ip)},children:"Turn on LED"})," ",Object(s.jsx)("button",{className:"btn btn-primary",onClick:function(){e.addBoard(n,t.ip)},children:"Add garden"})]}),Object(s.jsxs)("div",{className:"col-12 "+(e.state.boardbeingadded==n?"":"d-none"),children:["Retrieving data... ",Object(s.jsx)("br",{}),e.state.boardbeingaddedErr?"Something went wrong":"",e.state.boardbeingaddedSuccess?"Garden was sucessfully added! Close this dialog to manage it.":""]})]})}))]}):null,a=null;if(this.state.addDeviceNew)switch(console.log(this.state.addDeviceStage),console.log("restart"==this.state.addDeviceStage),this.state.addDeviceStage){case"checkconnectingmaster":a=Object(s.jsx)("div",{className:"container p-2",children:Object(s.jsx)("div",{className:"row",children:Object(s.jsxs)("div",{className:"col-12",children:[Object(s.jsx)("h6",{children:"Set up the master"}),Object(s.jsxs)("p",{children:["Connect to the WiFi network of the valve ",Object(s.jsx)("b",{children:"closest to your router."})]}),Object(s.jsx)("p",{children:'Your WiFi network should look like "AutoGarden-XXXXXXXX"'}),Object(s.jsx)("button",{onClick:this.setupConnectTo,children:"Connect to the board"}),this.state.connecting?Object(s.jsx)("p",{children:"Connecting..."}):null,this.state.wentwrong?Object(s.jsx)("p",{children:"Couldn't connect."}):null]})})});break;case"setupmaster1":a=Object(s.jsx)("div",{className:"container p-2",children:Object(s.jsx)("div",{className:"row",children:Object(s.jsxs)("div",{className:"col-12",children:[Object(s.jsx)("h6",{children:"Set up WiFi"}),Object(s.jsx)("p",{children:"Enter the name and password of your router's WiFi"}),Object(s.jsxs)("p",{children:["Name: ",Object(s.jsx)("input",{onChange:function(t){e.setState({wifiname:t.target.value})}})]})," ",Object(s.jsxs)("p",{children:["Password: ",Object(s.jsx)("input",{onChange:function(t){e.setState({wifipwd:t.target.value})}})]}),Object(s.jsx)("button",{onClick:this.setupWifiSettings,children:"Update WiFi"}),this.state.sendingwifi?Object(s.jsx)("p",{children:"Sending WiFi credentials..."}):null,this.state.sendingwififailed?Object(s.jsx)("p",{children:"Error in sending WiFi credentials!"}):null,this.state.sentwifi?Object(s.jsxs)("p",{children:["Sent WiFi credentials...",Object(s.jsx)("br",{}),"Checking WiFi status"]}):null,Object(s.jsxs)("p",{children:[this.state.wifistatusconn?Object(s.jsx)("span",{children:"Connected! "}):null,this.state.wifistatusnoconn?Object(s.jsx)("span",{children:"Not connected "}):null," ",Object(s.jsx)(O,{icon:"sync",ref:this._wifisetupflash})]}),Object(s.jsx)("button",{className:"btn btn-primary",onClick:function(){e.setState({addDeviceStage:"restart"})},children:"Next"})]})})});break;case"restart":console.log("here?"),a=Object(s.jsx)("div",{className:"container p-2",children:Object(s.jsx)("div",{className:"row",children:Object(s.jsxs)("div",{className:"col-12",children:[Object(s.jsx)("h6",{children:"Finishing up"}),Object(s.jsx)("p",{children:"The device may need to restart to finish setting up."}),Object(s.jsx)("button",{onClick:this.finishSetup,children:"Finish"}),this.state.sendingrestart?Object(s.jsx)("p",{children:"Finishing up..."}):null,this.state.complete?Object(s.jsx)("p",{children:"All done! Close this window to manage your valve."}):null]})})});break;default:this.setState({addDeviceStage:"checkconnectingmaster"})}return Object(s.jsxs)(B.Provider,{value:t,children:[Object(s.jsxs)("div",{className:"main-wrapper",children:[Object(s.jsx)(U,{}),Object(s.jsx)(Y,{updateGardens:this.updateGardens}),Object(s.jsx)("div",{className:"buttonsDiv",children:Object(s.jsx)("div",{onClick:function(){e._addDevicePopup.current.showPopup()},children:Object(s.jsx)("i",{className:"material-icons font-size-large cursor-pointer "+(this.state.searchEnabled?"":"text-muted"),children:"add_circle"})})})]}),Object(s.jsxs)(w,{ref:this._addDevicePopup,children:[Object(s.jsx)("h5",{children:"Add a new garden"}),Object(s.jsx)("div",{className:"w-50 d-inline-block p-2",children:Object(s.jsx)("button",{onClick:function(){e.setState({addDeviceSearch:!0,addDeviceNew:!1})},className:"btn btn-primary w-100",children:"Set up an existing garden"})}),Object(s.jsx)("div",{className:"w-50 d-inline-block p-2",children:Object(s.jsx)("button",{onClick:function(){e.setState({addDeviceSearch:!1,addDeviceNew:!0,addDeviceStage:"checkconnectingmaster"})},className:"btn btn-primary w-100",children:"Set up a new garden"})}),n,a]})]})}}]),n}(i.a.Component),V=function(){c.a.render(Object(s.jsx)(H,{}),document.getElementById("root"))};window.cordova?document.addEventListener("deviceready",(function(){V()}),!1):V()}},[[24,1,2]]]);
//# sourceMappingURL=main.e07cda38.chunk.js.map